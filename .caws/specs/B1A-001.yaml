id: B1A-001
type: chore
title: "B1: Cross-codebase parity fixtures — bundle, compile, apply golden lock tests"
status: closed
risk_tier: 3
mode: development
created_at: '2026-02-28T04:00:00.000Z'
updated_at: '2026-02-28T04:00:00.000Z'
blast_radius:
  modules:
    - tests/lock
  data_migration: false
operational_rollback_slo: 5m
scope:
  in:
    - tests/lock/tests/
    - tests/lock/src/
    - tests/lock/fixtures/
    - tests/lock/Cargo.toml
    - .caws/specs/
  out:
    - kernel/src/carrier/bytestate.rs
    - kernel/src/carrier/bytetrace.rs
    - kernel/src/carrier/code32.rs
    - kernel/src/proof/canon.rs
    - ml/
    - reference/v1_impl/
change_budget:
  max_files: 15
  max_loc: 500
invariants:
  - Golden bundle is deterministic and self-verifying
  - Regenerated bundle matches golden byte-for-byte
  - All normative artifact content hashes match
  - Bundle digest matches golden
acceptance:
  - given: The committed golden bundle directory
    when: Read back via read_bundle_dir and verified via verify_bundle
    then: Verification succeeds and artifact set matches expectations
  - given: The same harness scenario run in-memory
    when: Compared to the golden bundle
    then: All artifacts match byte-for-byte and bundle digest is identical
acceptance_criteria:
  - id: B1A-001-GOLDEN
    description: Committed golden fixture directory with 7 artifacts + 3 metadata files
    status: complete
  - id: B1A-001-SELF-VERIFY
    description: Golden bundle passes verify_bundle and verify_bundle_dir
    status: complete
  - id: B1A-001-REGEN
    description: In-memory regeneration matches golden byte-for-byte
    status: complete
  - id: B1B-001-COMPILE
    description: Compile parity — golden inputs/outputs + digest/manifest/descriptor lock tests
    status: complete
  - id: B1C-001-APPLY
    description: Apply parity — golden SET_SLOT step + post-state/step-record/evidence lock tests
    status: complete
evidence:
  commits:
    - 7711201  # B1a bundle surface parity
    - 0b73e03  # B1b compile parity
    - 3214d35  # B1c apply parity
    - c3c364f  # B1b/B1c tightenings (descriptor echo + evidence construction rule)
  total_tests: 494
  lock_tests:
    - tests/lock/tests/b1a_bundle_surface_parity.rs (7 tests)
    - tests/lock/tests/b1b_compile_parity.rs (7 tests)
    - tests/lock/tests/b1c_apply_parity.rs (7 tests)
  fixtures:
    - tests/lock/fixtures/b1a_rome_mini_search/ (10 files)
    - tests/lock/fixtures/b1b_compile_rome_mini_search/ (5 files)
    - tests/lock/fixtures/b1c_apply_rome_mini_search/ (12 files)
non_functional:
  a11y: []
  perf:
    note: Test runs a single search with small world; sub-second execution
  security: []
contracts: []
